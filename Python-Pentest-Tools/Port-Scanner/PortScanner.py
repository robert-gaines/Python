#!/usr/bin/env python

import threading
import socket
import time
import sys 

openPorts = []

def PortScanner(host,port):
    #
    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    #
    res = s.connect_ex((host,port))
    #
    if(res == 0):
        #
        openPorts.append(port)
        #
        return True
        #
    else:
        #
        return False
        #
    s.close()

def main():
    #
    print("""
    ******************
    *  Port Scanner  *
    ******************
          """)
    #
    print("[+] Enter the host address-> ")
    #
    host = sys.stdin.readline()
    #
    host = host.strip('\n')
    #
    fileObject = open(host+"_open_ports.txt",'w')
    #
    portList = []
    #
    threads = []
    #
    for i in range(0,1024): portList.append(i)
    #
    for p in portList:
        #
        t = threading.Thread(target=PortScanner,args=(host,p))
        #
        threads.append(t)
        #
    for x in portList:
        #
        threads[x].start()
        #
    for y in threads:
        #
        y.join()
        #
    print("""
*********************************
Open ports for: %s      
*********************************
          """ % (host))
    #
    fileObject.write("*** Open Ports on %s ***\n" % host)
    #
    for o in openPorts:
        #
        try:
            service = socket.getservbyport(int(o))
        except:
            pass
        #
        try:
            print("[*] %s : %s : %i " % (host,service,int(o)))
            #
            fileObject.write("[*] %s : %s : %i \n" % (host,service,int(o)))
            #
        except:
            print("[*] %s : Unknown : %i " % (host,int(o)))
            # 
            fileObject.write("[*] %s : Unknown : %i \n" % (host,int(o)))
            #
    time.sleep(3)
            #
    fileObject.close()

if(__name__ == '__main__'):
    #
    main()
