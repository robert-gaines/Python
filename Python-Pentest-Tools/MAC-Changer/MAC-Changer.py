#!/usr/bin/env python3

import subprocess
import random
import time
import sys
import re

def GenerateRandomMAC():
    #
    # MAC Format: XX:XX:XX:XX:XX:XX
    #
    RandomMAC = ''
    #
    for i in range(0,6):
        #
        for j in range(0,2):
            #
            RandomMAC += random.choice('0123456789abcdef')
            #
        RandomMAC += ':'
        #
    RandomMAC = RandomMAC[0:17]
    #
    return RandomMAC

def ChangeMACAddress(iface):
    #
    print("[*] Setting %s to down..." % iface)
    #
    time.sleep(1)
    #
    subprocess.call(["ifconfig",iface,"down"])
    #
    new_mac = ""
    #
    print('''
            1) Custom MAC Address
            2) Random MAC Address
          ''')
          #
    selection = input(">")
    #
    if(selection is "1"):
        #
        new_mac = input("[+] Enter the custom MAC-> ")
        #
        print("[*] MAC Address set to: %s " % new_mac)
        #
    elif(selection is "2"):
        #
        new_mac = GenerateRandomMAC()
        #
        print("[*] MAC Address set to: %s " % new_mac)
        #
    else:
        #
        print("[!] Unrecognized input, departing...")
        #
        sys.exit(1)
        #
    print("[*] Changing the MAC Address...")
    #
    time.sleep(1)
    #
    subprocess.call(["ifconfig",iface,"hw","ether",new_mac])
    #
    print("[*] Bring interface: %s back up..." % iface)
    #
    time.sleep(1)
    #
    subprocess.call(["ifconfig",iface,"up"])
    #
    return new_mac

def CheckMACAddress(iface,new_mac):
    #
    print("[*] Checking the MAC Address on: %s" % iface)
    #
    time.sleep(1)
    #
    iface_values = subprocess.check_output(['ifconfig',iface])
    #
    iface_values = str(iface_values)
    #
    # Regex Expression : \w\w:\w\w:\w\w:\w\w:\w\w:\w\w
    #
    mac_addr = re.search(r"\w\w:\w\w:\w\w:\w\w:\w\w:\w\w",iface_values)
    #
    if(mac_addr):
        #
        print("[*] Located: ", mac_addr.group(0))
        #
    else:
        #
        print("[!] MAC Value could not be located")

def main():
    #
    print("[*] Python MAC Changer [*]")
    #
    print()
    #
    iface = input("[+] Enter the subject interface-> ")
    #
    new_mac = ChangeMACAddress(iface)
    #
    CheckMACAddress(iface,new_mac)
    #
    sys.exit("[*] Departing! ")

if(__name__ == '__main__'):
    #
    main()
