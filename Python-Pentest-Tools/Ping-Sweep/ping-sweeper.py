#!/usr/bin/env python3

from queue import Queue
import subprocess
import ipaddress
import threading
import time
import os

live_hosts  = list()

def PingHost(host):
    #
    if(os.name == 'nt'):
        #
        output = subprocess.Popen(['ping','-n','1','-w','150',str(host)],stdout=subprocess.PIPE).communicate()[0]
        #
    else:
        #
        output = subprocess.Popen(['ping','-c','1','-w','150',str(host)],stdout=subprocess.PIPE).communicate()[0]
        #
    if('Reply' in output.decode('utf-8')):
        #
        live_hosts.append(host)
        #
    elif("Destination host unreachable" in output.decode('utf-8')):
        #
        return
        #
    elif("Request timed out" in output.decode('utf-8')):
        #
        return
        #
    else:
        #
        return

def Threader(q):
    #
    while(True):
        #
        host = q.get()
        #
        PingHost(host)
        #
        q.task_done()

def main():
    #
    q = Queue()
    #
    print("[*] Python Ping Sweeper [*]")
    #
    network = input("[+] Enter the network in CIDR notation (ex:'192.168.1.0/24') -> ")
    #
    potential_hosts = list(ipaddress.ip_network(network).hosts())
    #
    print("[*] Potential Host Count-> %i " % len(potential_hosts))
    #
    print("[*] Conducting sweep...")
    #
    start = time.perf_counter()
    #
    for p in potential_hosts:
        #
        q.put(p)
        #
    for i in range(100):
        #
        process = threading.Thread(target=Threader,args=(q,))
        #
        process.daemon = True 
        #
        process.start()
        #
    q.join()
    #
    end = time.perf_counter()
    #
    net_execution = end-start ; net_execution = net_execution/60
    #
    print("[*] Total hosts tested: %i " % len(potential_hosts))
    #
    print("[*] Net execution time (m): %i " % net_execution)
    #
    print("[*] Displaying live hosts...")
    #
    for host in live_hosts:
        #
        print("[*] Host alive at-> %s " % host)

if(__name__ =='__main__'):
    #
    main()